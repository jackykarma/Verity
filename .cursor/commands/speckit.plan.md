---
描述：使用计划模板执行实施规划工作流，以生成设计产物。
交接项：
  - 标签：创建任务
    执行主体：speckit.tasks
    提示信息：将计划拆解为具体任务
    发送状态：是
  - 标签：创建检查清单
    执行主体：speckit.checklist
    提示信息：为以下领域创建检查清单……
---

## 用户输入

```text
$ARGUMENTS
```

在继续操作前，你**必须**参考用户输入内容（若不为空）。

## 大纲

1. **环境搭建**：从代码库根目录运行 `.specify/scripts/powershell/setup-plan.ps1 -Json` 脚本，并解析 JSON 数据以获取 FEATURE_SPEC（功能规格）、IMPL_PLAN（实施计划）、SPECS_DIR（规格目录）、BRANCH（分支）。若参数中包含单引号（如 "I'm Groot"），需使用转义语法：例如 'I'\''m Groot'（若可行，也可使用双引号："I'm Groot"）。

2. **加载上下文**：读取 FEATURE_SPEC 文件和 `.specify/memory/constitution.md` 文件。加载已复制的 IMPL_PLAN 模板。

3. **执行计划工作流**：按照 IMPL_PLAN 模板的结构执行以下操作：
    - 填写技术背景（将未知项标记为“需澄清”）
    - 从章程文件中填充章程检查章节内容
    - 评估管控节点（若违规且无合理解释，判定为错误）
    - 第 0 阶段：生成 research.md 文件（解决所有“需澄清”项）
    - 第 1 阶段：生成 data-model.md、contracts/ 目录、quickstart.md 文件
    - 第 1 阶段：运行代理脚本更新代理上下文
    - 设计完成后重新评估章程检查结果

4. **停止并报告**：命令在第 2 阶段规划完成后终止。报告分支名称、IMPL_PLAN 文件路径及生成的产物。

## 阶段说明

### 第 0 阶段：大纲梳理与调研

1. **提取技术背景中的未知项**：
    - 每一项“需澄清”内容 → 对应一个调研任务
    - 每一项依赖项 → 对应一个最佳实践调研任务
    - 每一项集成项 → 对应一个模式调研任务

2. **生成并分派调研执行主体**：

   ```text
   针对技术背景中的每一项未知内容：
     任务：“为{功能背景}调研{未知项}”
   针对每一项技术选型：
     任务：“查找{领域}中{技术}的最佳实践”
   ```

3. **整理调研结果**并写入 `research.md` 文件，格式如下：
    - 决策：[选定的方案]
    - 依据：[选择该方案的原因]
    - 备选方案：[评估过的其他方案]

**输出物**：包含所有“需澄清”项解决方案的 research.md 文件

### 第 1 阶段：设计与契约制定

**前置条件**：`research.md` 文件内容完整

1. **从功能规格中提取实体** → 生成 `data-model.md` 文件：
    - 实体名称、字段、关联关系
    - 需求中的校验规则
    - 适用的状态流转逻辑

2. **根据功能需求生成 API 契约**：
    - 每个用户操作对应一个接口端点
    - 遵循 REST/GraphQL 标准设计模式
    - 将 OpenAPI/GraphQL 模式文件输出至 `/contracts/` 目录

3. **代理上下文更新**：
    - 运行 `.specify/scripts/powershell/update-agent-context.ps1 -AgentType cursor-agent` 脚本
    - 该脚本可识别当前使用的 AI 代理类型
    - 更新对应的代理专属上下文文件
    - 仅新增当前计划中涉及的技术内容
    - 保留标记区间内的手动新增内容

**输出物**：data-model.md 文件、/contracts/ 目录下所有文件、quickstart.md 文件、代理专属文件

## 核心规则

- 使用绝对路径
- 若管控节点校验失败或存在未解决的澄清项，判定为错误
```