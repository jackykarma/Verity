# Feature 规格说明：大图浏览与交互

**Epic**：EPIC-001 - Android 相册应用
**Feature 类型**：Product Feature
**Feature ID**：FEAT-002
**Feature Version**：v0.1.0
**EPIC 分支**：`epic/EPIC-001-android-gallery-app`
**Feature 目录**：`specs/epics/EPIC-001-android-gallery-app/features/FEAT-002-image-viewer-interaction/`
**创建时间**：2026-01-29
**状态**：草稿
**输入**：用户描述：`"大图浏览与交互：支持缩放、滑动切换、底部缩图轴快速导航"`

## 背景与价值 *（必填）*

- **背景**：在时间轴或图集列表中浏览缩略图后，用户需要查看照片/视频的完整细节。现有 Android 相册应用在大图浏览体验上存在不足，尤其缺少类似 iOS 相册的底部缩图轴快速导航功能。用户在大量照片场景下，难以快速定位到前后特定照片。
- **目标**：提供流畅、直观的大图浏览体验，支持双指缩放查看细节、左右滑动快速切换、底部缩图轴快速定位，打造媲美 iOS 相册的交互体验。**大图首帧显示速度与切换响应速度是本 Feature 的核心关注点。**
- **价值**：
  - **用户价值**：高效查看照片细节，流畅的缩放与切换交互，底部缩图轴提供快速导航能力，显著提升大量照片场景下的浏览效率
  - **业务价值**：大图浏览是核心体验亮点，底部缩图轴是差异化竞争优势，提升用户满意度与留存率
  - **技术价值**：构建高性能图片渲染与手势交互框架，**大图显示速度与切换响应速度优先**，支持流畅的缩放与滑动体验
- **范围（In Scope）**：
  - 全屏大图查看（照片和视频）
  - 双指缩放（pinch to zoom），支持缩放倍数 1x ~ 5x
  - 左右滑动切换照片/视频
  - 底部缩图轴快速定位（参考 iOS 相册）
  - 视频简单播放（切换到视频后自动播放，可暂停/继续，播放一遍后自动停止不循环，无进度控制）
  - 照片信息显示（拍摄时间、分辨率，可选显示）
- **范围外（Out of Scope）**：
  - 照片编辑功能（裁剪、滤镜、调色等，暂时不做）
  - 大图分享功能（分享至社交平台、系统分享，暂时不做）
  - 视频播放控制（进度条、快进、音量控制等）
  - 照片 EXIF 详细信息（GPS、相机参数等，仅显示基本信息）
  - 照片对比功能（同时查看多张照片）
  - 幻灯片播放模式

## 依赖关系 *（必填）*

- **上游依赖**：
  - **Feature 1 - 时间轴浏览**：提供进入大图浏览的入口（点击缩略图）和照片列表上下文
  - **Feature 6 - 图片加载与缓存框架**：提供高性能图片加载能力（缩略图和原图加载）
  - **UI 基础框架**（由 Feature 1 提供）：Activity/Fragment 架构、导航、主题
  - **媒体库访问**（Feature 5）：读取照片/视频元数据、文件路径
- **下游影响**：
  - **Feature 3 - 图集管理与浏览**：从图集内进入大图浏览，复用本 Feature 的大图组件
  - 后续 AI 功能（创作、搜索）：可能在大图页面添加 AI 操作入口
- **外部依赖故障模式**：
  - **图片加载失败**：显示占位符或错误提示，降级为列表视图
  - **视频播放失败**：显示错误提示，支持重试或返回列表
  - **底部缩图轴加载失败**：降级为无缩图轴模式，仅支持滑动切换

> 说明（重要）：本 Feature 依赖 Feature 1 的 UI 框架和 Feature 6 的图片加载框架，必须在这两个 Feature 完成后开始设计。

## 验收与场景 *（必填）*

> 说明：本节用于"可测试"的需求验收；**不等同于技术 Story**（技术 Story 在 Plan 阶段拆分）。

### 核心用户旅程（可选但强烈建议）

#### 旅程 1 - 从时间轴进入大图浏览并切换照片

- **描述**：用户在时间轴列表中点击某张照片，进入全屏大图浏览，可左右滑动切换前后照片
- **成功信号**：大图快速显示，滑动切换流畅无卡顿，用户可轻松浏览多张照片
- **验收场景**：
  1. **前提** 用户在时间轴列表中看到照片缩略图，**当** 点击某张照片，**则** 进入全屏大图浏览，低分辨率占位图在 500ms 内显示（P90），高分辨率图渐进加载（2s 内完成）
  2. **前提** 用户在大图浏览页面，**当** 向左滑动，**则** 切换到下一张照片，切换响应时间 < 200ms（P90）
  3. **前提** 用户在大图浏览页面，**当** 向右滑动，**则** 切换到上一张照片，切换响应时间 < 200ms（P90）
  4. **前提** 用户在大图浏览页面，**当** 点击顶部返回按钮、向下滑动手势或按下系统返回键，**则** 返回时间轴列表，定位到之前浏览的照片位置

#### 旅程 2 - 双指缩放查看照片细节

- **描述**：用户在大图浏览时使用双指缩放手势查看照片细节，缩放流畅无卡顿
- **成功信号**：缩放操作响应迅速，帧率 ≥ 60fps，图片细节清晰无锯齿
- **验收场景**：
  1. **前提** 用户在大图浏览页面，**当** 双指捏合缩小（pinch in），**则** 照片缩小，最小缩放至 1x（原始大小），缩放动画流畅（≥ 60fps）
  2. **前提** 用户在大图浏览页面，**当** 双指展开放大（pinch out），**则** 照片放大，最大缩放至 5x，缩放动画流畅（≥ 60fps）
  3. **前提** 用户在放大状态（> 1x），**当** 拖动照片，**则** 可查看照片不同区域，拖动响应流畅无延迟
  4. **前提** 用户在 1x 状态，**当** 双击照片，**则** 照片放大到 2x，动画流畅；在 2x 状态双击，**则** 照片恢复到 1x

#### 旅程 3 - 使用底部缩图轴快速定位照片

- **描述**：用户在大图浏览时使用底部缩图轴快速定位到前后特定照片，参考 iOS 相册体验
- **成功信号**：缩图轴可见易用，滚动流畅，点击跳转快速准确
- **验收场景**：
  1. **前提** 用户在大图浏览页面，**当** 查看底部区域，**则** 显示缩图轴，展示当前照片前后各 20 张（共 41 张）的缩略图
  2. **前提** 用户在大图浏览页面，**当** 左右滑动缩图轴，**则** 缩图轴滚动加载更多缩略图，滚动流畅无卡顿
  3. **前提** 用户在大图浏览页面，**当** 点击缩图轴中某张缩略图，**则** 大图切换到对应照片，切换响应时间 < 200ms（P90）
  4. **前提** 用户在大图浏览页面，**当** 左右滑动切换大图，**则** 缩图轴自动滚动到对应位置，高亮显示当前照片
  5. **前提** 用户在 1x 状态浏览照片，**当** 查看底部区域，**则** 缩图轴始终显示，不会自动隐藏
  6. **前提** 用户在大图浏览页面，**当** 放大照片至 > 1x，**则** 底部缩图轴自动隐藏，恢复到 1x 后自动显示

#### 旅程 4 - 查看照片详情信息

- **描述**：用户在大图浏览时查看照片的详细信息（拍摄时间、分辨率等）
- **成功信号**：详情信息默认隐藏，用户可通过按钮点击或上拉手势显示，支持关闭
- **验收场景**：
  1. **前提** 用户在大图浏览页面，**当** 查看屏幕，**则** 照片信息默认隐藏，显示完整照片内容
  2. **前提** 用户在大图浏览页面，**当** 点击"查看详情"按钮，**则** 从底部弹出照片详情面板，显示拍摄时间、分辨率等信息
  3. **前提** 用户在大图浏览页面，**当** 上拉图片，**则** 从底部弹出照片详情面板，显示拍摄时间、分辨率等信息
  4. **前提** 用户已显示照片详情面板，**当** 下拉详情面板或点击关闭按钮，**则** 详情面板关闭，恢复默认隐藏状态
  5. **前提** 用户已显示照片详情面板，**当** 滑动切换到下一张照片，**则** 详情面板自动关闭

#### 旅程 5 - 播放视频

- **描述**：用户在大图浏览时切换到视频，视频自动播放，可暂停/继续播放，播放一遍后自动停止
- **成功信号**：视频自动开始播放，音视频同步，支持暂停/继续，播放完成后停止并显示播放按钮
- **验收场景**：
  1. **前提** 用户在大图浏览页面，**当** 滑动切换到视频，**则** 视频自动开始播放，音视频同步，底部缩图轴自动隐藏
  2. **前提** 视频正在播放，**当** 点击暂停按钮，**则** 视频暂停播放，底部缩图轴自动显示
  3. **前提** 视频已暂停，**当** 点击播放按钮，**则** 视频继续播放，底部缩图轴自动隐藏
  4. **前提** 视频正在播放，**当** 播放到结尾，**则** 视频自动停止（不循环），显示播放按钮供用户重新播放，底部缩图轴自动显示
  5. **前提** 视频正在播放，**当** 向左或向右滑动，**则** 视频停止播放，切换到下一张/上一张照片或视频

### 边界与异常场景（必填）

- **大图加载失败** → 若低分辨率占位图加载失败，显示错误提示（"图片加载失败"）和重试按钮；若仅高分辨率图加载失败，保留低分辨率占位图并提示"高清图加载失败"
- **视频播放失败** → 显示错误提示（"视频播放失败"），提供重试按钮
- **底部缩图轴加载失败** → 降级为无缩图轴模式，仅支持滑动切换，不影响核心浏览功能
- **内存不足（OOM 风险）** → 释放大图缓存，降级加载较低分辨率图片，避免应用崩溃
- **照片数量为 1 张** → 禁用滑动切换功能，底部缩图轴仅显示当前照片
- **照片数量 ≤ 41 张** → 底部缩图轴显示全部照片，无需滚动
- **照片已被删除（并发删除）** → 显示提示（"照片不存在"），自动跳过该照片，切换到下一张
- **缩放超出边界** → 限制最小缩放 1x，最大缩放 5x，超出时回弹至边界
- **快速滑动切换** → 使用预加载机制，确保切换流畅，避免白屏
- **设备旋转** → 保持当前浏览位置和缩放状态，重新加载布局
- **在放大状态（> 1x）下返回** → 系统返回键第一次按下恢复到 1x，第二次按下返回列表；向下滑动和返回按钮直接返回列表
- **在视频播放时返回** → 停止视频播放，返回时间轴/图集列表

## FR / NFR *（必填）*

### FR（Functional Requirements）

> 规则：每条 FR 必须**可测试**，避免"提升体验/更快/更稳定"这类不可验证表述。

- **FR-001**：用户必须能够从时间轴或图集列表点击照片进入全屏大图浏览，系统采用分级加载策略（先显示低分辨率占位图，再渐进加载高分辨率图）
- **FR-002**：用户必须能够在大图浏览页面左右滑动切换前后照片或视频
- **FR-003**：用户必须能够使用双指缩放手势（pinch to zoom）放大或缩小照片，缩放倍数范围 1x ~ 5x
- **FR-004**：用户必须能够在放大状态（> 1x）时拖动照片查看不同区域
- **FR-005**：用户必须能够双击照片，在 1x（原始大小）和 2x（快速查看细节）之间智能切换
- **FR-006**：用户必须能够看到底部缩图轴，显示当前照片前后的缩略图列表（参考 iOS 相册），缩图轴在正常浏览时始终显示，仅在视频播放或照片放大（> 1x）状态时自动隐藏
- **FR-016**：系统必须在用户放大照片（> 1x）或播放视频时自动隐藏底部缩图轴，恢复到 1x 或停止视频后自动显示
- **FR-007**：用户必须能够滚动底部缩图轴，查看更多前后照片的缩略图
- **FR-008**：用户必须能够点击底部缩图轴中的缩略图，快速跳转到对应照片
- **FR-009**：系统必须在用户切换到视频时自动开始播放，用户可点击暂停按钮暂停播放，点击播放按钮继续播放
- **FR-014**：系统必须在视频播放一遍后自动停止（不循环），显示播放按钮供用户重新播放
- **FR-010**：系统必须在大图浏览页面默认隐藏照片信息，用户可通过点击"查看详情"按钮或上拉图片手势显示照片详情信息（拍摄时间、分辨率等）
- **FR-015**：系统必须在用户显示照片详情信息后，提供关闭详情的方式（下拉手势或点击关闭按钮）
- **FR-011**：用户必须能够通过多种方式从大图浏览页面返回到时间轴或图集列表：点击顶部返回按钮、向下滑动手势、系统返回键，返回后定位到之前浏览的位置
- **FR-012**：系统必须在底部缩图轴高亮显示当前正在浏览的照片
- **FR-013**：系统必须在用户滑动切换大图时，自动滚动底部缩图轴到对应位置

### NFR（Non-Functional Requirements）

> 规则：每条 NFR 必须**量化**并附带验收方式；细化评估在 Plan 阶段完成。

#### 性能（Performance）

> **关键关注点**：大图首帧显示速度与切换响应速度为本 Feature 的 P0 非功能约束，必须优先满足。

- **NFR-PERF-001**：大图首帧显示时间 < 500ms（P90），从点击缩略图到低分辨率占位图显示的时间；高分辨率图渐进加载时间 < 2s（P90）
- **NFR-PERF-002**：大图切换响应时间 < 200ms（P90），从滑动手势结束到下一张照片显示的时间
- **NFR-PERF-003**：大图缩放操作帧率 ≥ 60fps，无明显卡顿感，测量方法：使用 Android Profiler 的 Frame Rendering 工具
- **NFR-PERF-004**：底部缩图轴滚动帧率 ≥ 55fps，滚动流畅无卡顿
- **NFR-PERF-005**：大图切换预加载机制生效，前后各预加载 2 张照片（低分辨率），确保快速滑动时无白屏
- **NFR-PERF-006**：分级加载过渡自然流畅，低分辨率到高分辨率切换无明显闪烁或跳变

#### 功耗（Power）

- **NFR-POWER-001**：大图浏览 10 分钟，电量消耗 < 2%（假设屏幕亮度 50%，测试设备为中端机型）

#### 内存（Memory）

- **NFR-MEM-001**：大图浏览时峰值内存增量 < 100MB（单张照片），测量方法：使用 Android Profiler 的 Memory 工具
- **NFR-MEM-002**：大图浏览切换 100 张照片后，内存无明显泄漏（增量 < 50MB），使用 LeakCanary 检测
- **NFR-MEM-003**：底部缩图轴缓存内存占用 < 40MB（缓存 41 张可见缩略图 + 预加载缓冲）

#### 安全与隐私（Security/Privacy）

- **NFR-SEC-001**：大图浏览仅访问用户已授权的照片，不访问其他应用的私有数据
- **NFR-SEC-002**：照片浏览记录不上传至服务器，符合隐私政策

#### 可观测性（Observability）

- **NFR-OBS-001**：记录大图首帧显示时间、切换响应时间、缩放帧率等性能指标，采样率 10%
- **NFR-OBS-002**：记录大图加载失败、视频播放失败等错误日志，采样率 100%
- **NFR-OBS-003**：记录用户使用底部缩图轴的频次，分析功能使用率

#### 可靠性（Reliability）

- **NFR-REL-001**：大图加载失败率 < 1%（P90），测量方法：加载成功次数 / 总加载次数
- **NFR-REL-002**：大图浏览切换 1000 次，应用无崩溃（ANR 或 Crash）
- **NFR-REL-003**：视频播放失败时提供降级方案（显示视频缩略图 + 重试按钮）

## 验收标准（Feature Level）*（必填）*

- **AC-001**：用户从时间轴点击照片进入大图浏览，低分辨率占位图在 500ms 内显示（P90），高分辨率图在 2s 内渐进加载完成（关联: FR-001, NFR-PERF-001）
- **AC-002**：用户在大图浏览页面左右滑动，切换到前后照片，切换响应时间 < 200ms（P90）（关联: FR-002, NFR-PERF-002）
- **AC-003**：用户使用双指缩放手势放大照片至 1x ~ 5x，缩放操作帧率 ≥ 60fps，无卡顿（关联: FR-003, NFR-PERF-003）
- **AC-004**：用户在放大状态拖动照片，可查看不同区域，拖动响应流畅无延迟（关联: FR-004）
- **AC-005**：用户双击照片，在 1x 和 2x 之间智能切换，动画流畅无卡顿（关联: FR-005）
- **AC-006**：用户在大图浏览页面看到底部缩图轴，显示当前照片前后的缩略图，高亮显示当前照片（关联: FR-006, FR-012）
- **AC-007**：用户滚动底部缩图轴，可查看更多缩略图，滚动帧率 ≥ 55fps（关联: FR-007, NFR-PERF-004）
- **AC-008**：用户点击底部缩图轴中的缩略图，快速跳转到对应照片，切换响应时间 < 200ms（P90）（关联: FR-008, NFR-PERF-002）
- **AC-009**：用户切换到视频时自动开始播放，音视频同步；点击暂停按钮可暂停，点击播放按钮可继续播放（关联: FR-009）
- **AC-017**：视频播放一遍后自动停止（不循环），显示播放按钮供用户重新播放（关联: FR-014）
- **AC-010**：用户在大图浏览页面默认看不到照片信息；点击"查看详情"按钮或上拉图片后，显示照片详情面板（拍摄时间、分辨率等）（关联: FR-010）
- **AC-018**：用户显示照片详情面板后，可通过下拉手势或点击关闭按钮关闭详情面板（关联: FR-015）
- **AC-019**：用户在 1x 状态浏览照片时，底部缩图轴始终显示；放大至 > 1x 时自动隐藏，恢复到 1x 后自动显示（关联: FR-006, FR-016）
- **AC-020**：用户播放视频时，底部缩图轴自动隐藏；暂停或播放结束后自动显示（关联: FR-016）
- **AC-011**：用户可通过顶部返回按钮、向下滑动手势或系统返回键从大图浏览页面返回，返回后定位到之前浏览的位置（关联: FR-011）
- **AC-012**：用户滑动切换大图时，底部缩图轴自动滚动到对应位置（关联: FR-013）
- **AC-013**：大图加载失败时显示错误提示和重试按钮，不导致应用崩溃（关联: NFR-REL-001）
- **AC-014**：大图浏览切换 1000 次，应用无 ANR 或 Crash（关联: NFR-REL-002）
- **AC-015**：大图浏览 10 分钟，内存增量 < 100MB，无内存泄漏（关联: NFR-MEM-001, NFR-MEM-002）
- **AC-016**：分级加载过渡自然流畅，低分辨率到高分辨率切换无明显闪烁（关联: NFR-PERF-006）

## 核心实体（如涉及数据则必填）

- **MediaItem**：媒体项实体，包含照片或视频的元数据
  - 核心属性：id（唯一标识）、uri（文件路径）、type（照片/视频）、displayName（文件名）、dateAdded（添加时间）、size（文件大小）、width（宽度）、height（高度）
  - 关系：属于某个相册（Album），可以在时间轴或图集中展示
- **ImageViewState**：大图浏览状态实体，记录当前浏览位置和缩放状态
  - 核心属性：currentIndex（当前照片索引）、scaleX（X 轴缩放倍数）、scaleY（Y 轴缩放倍数）、offsetX（X 轴偏移）、offsetY（Y 轴偏移）
  - 关系：与 MediaItem 列表关联，支持状态恢复（如设备旋转）

## 假设与约束 *（必填）*

- **假设**：
  - **假设 1**：用户设备支持硬件加速（OpenGL ES 2.0+），用于流畅的图片缩放和渲染（影响：低端设备体验可能下降，需降级处理）
  - **假设 2**：照片分辨率在合理范围内（≤ 8000x8000 像素），系统采用分级加载策略（先加载低分辨率占位图，再渐进加载高分辨率图），超大分辨率照片自动降采样以避免 OOM（影响：极高分辨率照片可能无法加载到原始分辨率）
  - **假设 3**：视频格式为常见格式（MP4、MOV），系统 MediaPlayer 支持播放（影响：不支持的格式显示错误提示）
  - **假设 4**：底部缩图轴实现参考 iOS 相册，技术实现需自研或深度定制（影响：开发成本较高，需充分测试交互体验）
  - **假设 5**：大图浏览仅支持单张浏览，不支持多张对比（影响：对比功能需后续 EPIC 扩展）
- **约束**：
  - **平台**：Android 10+ (API Level 29+)
  - **权限**：依赖 Feature 5 的媒体库访问权限
  - **性能（关键关注点）**：**大图首帧显示速度与切换响应速度为本 Feature 重点约束**。大图首帧 < 500ms，切换 < 200ms，缩放 ≥ 60fps
  - **UI 交互**：底部缩图轴需参考 iOS 相册体验，技术实现需自研或深度定制
  - **依赖**：依赖 Feature 1 的 UI 框架、Feature 6 的图片加载框架、Feature 5 的媒体库访问

## 需求追溯（预留，Plan 后填写）

> 说明：此表在 Plan 的 Story Breakdown 完成后填写，用于确保 FR/NFR 被 Story 覆盖；Implement 不得擅自改写 FR/NFR。

| FR/NFR ID | 计划覆盖的 Story ID（Plan） | 任务覆盖（Tasks） | 备注 |
|---|---|---|---|
| FR-001 | ST-??? | T??? |  |
| FR-002 | ST-??? | T??? |  |
| FR-003 | ST-??? | T??? |  |
| FR-004 | ST-??? | T??? |  |
| FR-005 | ST-??? | T??? |  |
| FR-006 | ST-??? | T??? |  |
| FR-007 | ST-??? | T??? |  |
| FR-008 | ST-??? | T??? |  |
| FR-009 | ST-??? | T??? |  |
| FR-010 | ST-??? | T??? |  |
| FR-011 | ST-??? | T??? |  |
| FR-012 | ST-??? | T??? |  |
| FR-013 | ST-??? | T??? |  |
| FR-014 | ST-??? | T??? |  |
| FR-015 | ST-??? | T??? |  |
| FR-016 | ST-??? | T??? |  |
| NFR-PERF-001 | ST-??? | T??? |  |
| NFR-PERF-002 | ST-??? | T??? |  |
| NFR-PERF-003 | ST-??? | T??? |  |
| NFR-PERF-004 | ST-??? | T??? |  |
| NFR-PERF-005 | ST-??? | T??? |  |
| NFR-PERF-006 | ST-??? | T??? |  |
| NFR-POWER-001 | ST-??? | T??? |  |
| NFR-MEM-001 | ST-??? | T??? |  |
| NFR-MEM-002 | ST-??? | T??? |  |
| NFR-MEM-003 | ST-??? | T??? |  |
| NFR-SEC-001 | ST-??? | T??? |  |
| NFR-SEC-002 | ST-??? | T??? |  |
| NFR-OBS-001 | ST-??? | T??? |  |
| NFR-OBS-002 | ST-??? | T??? |  |
| NFR-OBS-003 | ST-??? | T??? |  |
| NFR-REL-001 | ST-??? | T??? |  |
| NFR-REL-002 | ST-??? | T??? |  |
| NFR-REL-003 | ST-??? | T??? |  |

## 澄清内容

### 会话 2026-01-29

- 问题：底部缩图轴应该显示多少张缩略图？ → 答案：固定显示前后各 20 张（共 41 张），提供更大导航范围
- 问题：大图加载时，应该采用什么分辨率策略？ → 答案：分级加载（先加载低分辨率占位图，再逐步加载高分辨率）
- 问题：缩放手势中的"双击"行为应该如何定义？ → 答案：智能缩放（双击在 1x 和 2x 之间切换）
- 问题：用户切换到视频时，视频播放行为应该如何？ → 答案：先自动播放，用户可点击暂停；但不循环播放，播放一遍后就停止并显示播放按钮
- 问题：照片信息（拍摄时间、分辨率）的显示/隐藏行为应该如何？ → 答案：默认隐藏，大图预览页点击查看详情按钮或是上拉图片就显示详情信息
- 问题：用户从大图浏览返回时间轴/图集时，支持哪些操作方式？ → 答案：多种方式（顶部返回按钮 + 向下滑动手势 + 系统返回键）
- 问题：底部缩图轴在用户操作时的显示/隐藏行为应该如何？ → 答案：始终显示，不可隐藏（仅在视频播放或放大状态时自动隐藏）

## 变更记录（增量变更）

| 版本 | 日期 | 变更范围 | 变更摘要 | 影响 | 是否需要回滚 |
|---|---|---|---|---|---|
| v0.1.0 | 2026-01-29 | 初始版本 | 创建 Feature 规格说明，定义大图浏览与交互的 FR/NFR | 无 | 否 |
