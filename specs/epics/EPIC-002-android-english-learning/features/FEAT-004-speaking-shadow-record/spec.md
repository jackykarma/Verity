# Feature 规格说明：口语训练（跟读/复述、录音与回放、可选评分）

**Epic**：EPIC-002 - Android 端英语学习 APP
**Feature 类型**：Product Feature
**Feature ID**：FEAT-004
**Feature Version**：v0.1.0
**EPIC 分支**：`epic/EPIC-002-android-english-learning`
**Feature 目录**：`specs/epics/EPIC-002-android-english-learning/features/FEAT-004-speaking-shadow-record/`
**创建时间**：2026-01-25
**状态**：草稿
**输入**：用户描述：`"口语训练：跟读/复述、录音与回放，可选简单评分；示范发音需遵循设置中的英式/美式偏好。"`

## 背景与价值 *（必填）*

- **背景**：用户需要通过跟读、复述等输出型训练强化口语，并听到自己的录音以自我纠偏；示范发音需与用户偏好的英式/美式一致，以建立正确口音习惯。
- **目标**：用户可完成跟读或复述、录制自己的语音、回放对比，并获得完成反馈（如「已完成」/✓）；示范音须遵循设置中的发音偏好。简单评分作为后续迭代。
- **价值**：为口语强化用户提供闭环练习能力，与听力、单词等模块形成听说记联动；发音偏好统一提升学习一致性。
- **范围（In Scope）**：跟读/复述练习、示范发音播放（遵循英式/美式偏好）、用户录音、回放、**完成反馈**（首版）。**对比播放**（示范音与用户录音切换/顺序）首版不强制，由 Plan 定；简单评分为后续迭代。
- **范围外（Out of Scope）**：全句纠音、多轮对话、复杂口语测评模型、云端语音识别或评分服务；发音偏好本身的配置归属「设置」Feature；**首版不含简单评分**，简单评分作为后续迭代。

## 澄清内容

### 会话 2026-01-25

- 问题：「简单评分」与「完成反馈」的关系及实现范围 → 答案：首版只做「完成反馈」，简单评分后续迭代。
- 问题：NFR-POWER-001 是否在本 spec 定硬性 mAh 上限 → 答案：不定，Plan 阶段评估即可；本 spec 保留定性描述。
- 问题：跟读/复述的「训练材料」来源 → 答案：首版仅内置少量示例（打包在 APP 内），不依赖听力/阅读。
- 问题：用户录音的保留策略与存储上限 → 答案：持久化，条数上限（如 50 条）；超限时 FIFO 或提示用户删最旧。
- 问题：示范音与用户录音的「对比播放」首版是否必须？ → 答案：首版不必须，由产品/Plan 定。

## 依赖关系 *（必填）*

- **上游依赖**：设置 Feature（发音偏好英式/美式的持久化与查询接口）；系统 TTS 或第三方语音引擎（按偏好合成英/美示范音）；设备麦克风与扬声器；本地存储（录音文件、缓存）。**首版训练材料为内置示例**，不依赖听力、阅读 Feature。
- **下游影响**：无；本 Feature 为终端训练模块。
- **外部依赖故障模式**：TTS/语音引擎不可用或超时时，示范音降级为仅展示文本并提示用户检查语音服务；麦克风不可用或未授权时，阻止录音并提示授权；存储不足时提示用户并禁止新录音。

## 验收与场景 *（必填）*

### 核心用户旅程（可选但强烈建议）

#### 旅程 1 - 跟读练习

- **描述**：用户选择跟读材料，听示范发音，自己跟读并录音，回放对比，获得完成反馈（如「已完成」/✓）。
- **成功信号**：用户完成至少一次「听示范 → 录音 → 回放」闭环，且示范音口音与设置中的英/美偏好一致。
- **验收场景**：
  1. **前提** 已设置发音偏好（如美式），**当** 用户进入跟读并播放示范音，**则** 示范音为美式口音。
  2. **前提** 已授权麦克风，**当** 用户点击录音并跟读，**则** 系统录制用户语音并在结束后可回放。
  3. **前提** 完成录音，**当** 用户选择回放，**则** 可播放用户录音；对比播放（与示范音切换或连续）首版不强制，由 Plan 定。

#### 旅程 2 - 复述练习

- **描述**：用户听/看材料后复述，录音并回放，获得完成反馈（如「已完成」/✓）。
- **成功信号**：用户完成「听/看 → 复述录音 → 回放」闭环，并收到完成反馈。

- **验收场景**：
  1. **前提** 材料与示范音就绪，**当** 用户播放示范音，**则** 口音遵循设置中的英/美偏好。
  2. **前提** 用户完成复述录音，**当** 流程结束，**则** 提供回放与完成反馈（如「已完成」/✓）。

### 边界与异常场景（必填）

- 麦克风未授权 → 进入录音前提示授权，授权前禁用录音并给出操作指引。
- 存储空间不足 → 禁止新录音，提示清理存储；已有录音可正常回放与删除。
- 达到录音条数上限 → 禁止新录音，并按 FIFO 自动删除最旧一条后允许再录，或提示用户手动删除部分录音后再录；具体策略在 Plan 定。
- TTS/示范音不可用或超时 → 降级为仅展示文本，提示「语音暂不可用，请检查系统语音或稍后重试」；不阻塞复述/录音流程（用户仍可对着文本自练并录音）。
- 发音偏好未设置（极端情况） → 使用 EPIC 约定缺省（美式），或从设置模块读取缺省。
- 录音/回放过程中来电或切后台 → 暂停录音或播放；恢复后可继续或重新开始，不 silently 丢数据；若发生中断，已录片段按产品策略保留或提示用户。

## FR / NFR *（必填）*

### FR（Functional Requirements）

- **FR-001**：系统必须提供示范发音播放；示范发音的英式/美式口音必须来自设置中的发音偏好，且切换偏好后，再次进入口语训练时示范音须为最新偏好。
- **FR-002**：用户必须能够对当前跟读/复述材料进行录音；录音起止由用户显式控制（如按一下开始、再按结束），且在有麦克风权限时方可录音。
- **FR-003**：用户必须能够回放自己的录音。**对比播放**（示范音与用户录音的切换或顺序播放）首版不强制，由产品/Plan 定；若实现则可在二者之间切换或顺序播放以便对比。
- **FR-004**：首版系统必须提供**完成反馈**（如「已完成」/✓），在用户完成录音并结束流程时展示；**简单评分**不在本版实现，作为后续迭代。
- **FR-005**：在用户未授权麦克风时，系统必须明确提示需授权方可录音，并提供跳转系统设置或授权入口；不得在未授权时静默尝试录音。

### NFR（Non-Functional Requirements）

#### 性能（Performance）

- **NFR-PERF-001**：示范音从请求到开始播放的端到端延迟不超过 2 秒（与 EPIC-NFR-PERF-002 一致）；录音启动（按键到真正开始录）≤1s。首版无评分，无评分延迟指标；若后续迭代提供简单评分，延迟在彼时 spec 中约定。

#### 功耗（Power）

- **NFR-POWER-001**：单次口语练习会话（含示范播放、录音、回放各若干次）在典型中端机上的额外功耗可接受；连续录音 10 分钟内不出现明显发热或电量异常。**不定硬性 mAh 上限**，具体 mAh 预算在 Plan 阶段评估；本 spec 仅保留上述定性描述作为验收参考。

#### 内存（Memory）

- **NFR-MEM-001**：口语训练会话期间内存增量符合 EPIC-NFR-MEM-001（常规会话 P50 ≤300MB）；录音缓存与临时文件在会话结束或退出模块后可回收。持久化录音受**条数上限**约束（见核心实体「用户录音」），不无限占用存储。

#### 安全与隐私（Security/Privacy）

- **NFR-SEC-001**：麦克风按最小范围、在使用前申请；用户语音仅本地处理与存储，不未经同意上传；遵循 EPIC-NFR-SEC-001。录音文件存储于应用私有目录，不被其他应用直接访问。

#### 可观测性（Observability）

- **NFR-OBS-001**：关键失败可观测：示范音加载失败、麦克风不可用、录音失败、存储不足、评分超时或失败等须有日志或埋点，便于排查；与 EPIC-NFR-OBS-001 一致，首版可轻量。

#### 可靠性（Reliability）

- **NFR-REL-001**：TTS/麦克风不可用时按「依赖关系」中的降级策略处理，不崩溃；录音过程中若发生异常中断，已录数据按实现策略尽量保留或明确提示用户，避免静默丢音。

## 验收标准（Feature Level）*（必填）*

- **AC-001**：用户在设置中切换英式/美式后，进入口语训练播放示范音，可验证示范音口音与当前偏好一致；覆盖 FR-001。
- **AC-002**：用户在有麦克风权限时完成至少一次跟读或复述的完整录音，并成功回放；覆盖 FR-002、FR-003。
- **AC-003**：用户在未授权麦克风时，进入录音流程会收到明确授权提示，且不能完成录音；覆盖 FR-005。
- **AC-004**：用户完成一次录音并结束流程后，可获得完成反馈（如「已完成」/✓）；录音与回放流程正常。覆盖 FR-004。
- **AC-005**：在 TTS 不可用或麦克风不可用时，按规格降级（示范音→文本+提示，录音→提示），不崩溃；覆盖 NFR-REL-001、依赖故障模式。

## 核心实体（如涉及数据则必填）

- **训练材料**：一次跟读/复述的上下文；含示范文本、示范音资源引用（或 TTS 参数，含英/美偏好）。**首版来源为内置少量示例**，打包在 APP 内，不依赖听力/阅读 Feature；与听力/阅读材料的复用留待后续迭代。
- **用户录音**：单次录音产出；核心属性含音频文件引用、关联材料 ID、时间戳、时长；**持久化**于应用私有目录，仅存于本地。**条数上限**（如 50 条，具体数值在 Plan 定）；超限时按 FIFO 删除最旧录音，或提示用户手动删除后再录。首版不关联评分结果。
- **评分结果（后续迭代）**：简单评分若在后续迭代提供；属性含分数或等级、简评文本、关联录音 ID；本版不需要此实体。

## 假设与约束 *（必填）*

- **假设**：设备具备麦克风且用户可授权；系统 TTS 或已集成的第三方引擎支持按英/美参数合成；用户语音仅用于本地播放与完成反馈，不涉及云端识别或存储；设置 Feature 已提供发音偏好的读取接口。
- **约束**：Android 8.0+ / API 26+；麦克风、存储（若需写录音文件）权限需声明并在使用前申请；须符合 EPIC 的 NFR 与隐私要求。首版仅完成反馈，无评分逻辑；若后续迭代做简单评分，则为端侧或离线能力。

## 需求追溯（预留，Plan 后填写）

> 说明：此表在 Plan 的 Story Breakdown 完成后填写，用于确保 FR/NFR 被 Story 覆盖；Implement 不得擅自改写 FR/NFR。

| FR/NFR ID | 计划覆盖的 Story ID（Plan） | 任务覆盖（Tasks） | 备注 |
|---|---|---|---|
| FR-001 | ST-??? | T??? |  |
| FR-002 | ST-??? | T??? |  |
| FR-003 | ST-??? | T??? |  |
| FR-004 | ST-??? | T??? |  |
| FR-005 | ST-??? | T??? |  |
| NFR-PERF-001 | ST-??? | T??? |  |
| NFR-POWER-001 | ST-??? | T??? |  |
| NFR-MEM-001 | ST-??? | T??? |  |
| NFR-SEC-001 | ST-??? | T??? |  |
| NFR-OBS-001 | ST-??? | T??? |  |
| NFR-REL-001 | ST-??? | T??? |  |

## 变更记录（增量变更）

| 版本 | 日期 | 变更范围 | 变更摘要 | 影响 | 是否需要回滚 |
|---|---|---|---|---|---|
| v0.1.0 | 2026-01-25 | 全文 | 初稿，基于 EPIC-002 口语训练边界与用户输入 | — | 否 |
| v0.1.1 | 2026-01-25 | 澄清：评分与完成反馈 | 首版仅完成反馈，简单评分后续迭代；已整合至 澄清内容、FR/背景/验收/AC/实体/假设 | FR-004、AC-004、范围、旅程、NFR-PERF-001 等 | 否 |
| v0.1.2 | 2026-01-25 | 澄清：功耗 mAh 上限 | NFR-POWER-001 不定硬性 mAh 上限，Plan 评估；保留定性描述 | NFR-POWER-001、需求追溯 | 否 |
| v0.1.3 | 2026-01-25 | 澄清：训练材料来源 | 首版仅内置少量示例，打包在 APP 内，不依赖听力/阅读 | 训练材料、上游依赖 | 否 |
| v0.1.4 | 2026-01-25 | 澄清：录音保留与上限 | 持久化，条数上限（如 50 条）；超限时 FIFO 或提示用户删最旧 | 用户录音、NFR-MEM-001、边界与异常 | 否 |
| v0.1.5 | 2026-01-25 | 澄清：对比播放首版是否必须 | 首版不必须，由产品/Plan 定 | FR-003、范围、验收场景 | 否 |
