# Feature 规格说明：间隔重复学习算法引擎

**Epic**：EPIC-001 - 无痛记忆单词神器APP
**Feature 类型**：Platform-Capability Feature
**Feature ID**：FEAT-002
**Feature Version**：v0.1.0
**EPIC 分支**：`epic/EPIC-001-word-memory-app`
**Feature 目录**：`specs/epics/EPIC-001-word-memory-app/features/FEAT-002-spaced-repetition-algorithm/`
**创建时间**：2026-01-18
**状态**：草稿
**输入**：用户描述：`"间隔重复学习算法引擎：实现基于遗忘曲线的智能学习调度算法，支持复习时机计算和学习状态管理"`

## 背景与价值 *（必填）*

- **背景**：
  - 传统单词记忆方法缺乏科学指导，用户难以在最佳复习时机进行复习，导致记忆效率低下
  - 间隔重复算法是基于遗忘曲线的科学记忆方法，能够在记忆衰减的关键时间点安排复习，显著提升记忆效率
  - 学习调度算法是产品的核心竞争力，需要独立封装为可复用的平台能力，便于测试、优化和扩展
  - 算法引擎需要根据用户学习历史智能计算复习时机，确保学习调度准确有效

- **目标**：
  - **用户目标**：用户能够通过科学的间隔重复算法在最佳时机复习单词，提升记忆效率
  - **业务目标**：建立核心学习算法引擎，支撑产品的差异化竞争力，提升用户学习效果和留存率
  - **平台目标**：建立可扩展、可测试、可优化的算法引擎框架，支持未来算法参数调优和个性化适配

- **价值**：
  - **用户价值**：显著提升单词记忆效率，减少无效复习次数，降低学习负担
  - **业务价值**：形成算法能力护城河，支撑核心学习功能，提升用户粘性和留存率
  - **技术价值**：建立可复用的算法引擎框架，积累算法参数调优经验，为后续个性化算法提供基础

- **范围（In Scope）**：
  - 基于遗忘曲线的学习调度算法（支持 SuperMemo、SM-2 等经典算法）
  - 复习时机计算（根据学习历史和记忆强度计算下次复习时间）
  - 学习状态管理（跟踪单词的学习次数、最后复习时间、记忆强度、下次复习时间）
  - 记忆强度评估（基于用户回答正确率和复习间隔评估记忆强度）
  - 算法参数配置（支持算法参数的基础配置，如初始间隔、难度因子等）

- **范围外（Out of Scope）**：
  - 机器学习模型训练（第一阶段使用经典算法，不使用机器学习模型）
  - 个性化算法调优（第一阶段使用通用算法参数，不支持基于用户特征的个性化调优）
  - 算法可视化展示（算法调度过程的可视化不在本 Feature 范围，由学习界面 Feature 负责）
  - 多用户学习数据共享（算法引擎仅处理单用户的学习数据）

## 依赖关系 *（必填）*

- **上游依赖**：
  - **单词库管理（FEAT-001）**：获取词库数据和单词列表，作为算法引擎的学习内容来源
  - **用户账户与数据管理（FEAT-007）**：存储和查询用户学习历史数据（学习记录、复习记录）
  - **间隔重复算法理论**：基于遗忘曲线理论（Ebbinghaus）和 SuperMemo/SM-2 等经典算法

- **下游影响**：
  - **学习界面与交互（FEAT-003）**：依赖算法引擎获取需要学习和复习的单词列表
  - **学习进度与统计（FEAT-005）**：依赖算法引擎提供学习状态数据用于统计和报告
  - **游戏化与激励机制（FEAT-004）**：依赖算法引擎的学习进度数据用于成就和积分计算

- **外部依赖故障模式**：
  - **词库数据缺失**：词库数据不可用时，算法引擎无法计算复习任务，应返回空列表并记录错误日志
  - **学习历史数据损坏**：学习历史数据损坏时，算法引擎应能够容错处理，使用默认参数重新开始学习
  - **算法计算异常**：算法计算过程中出现异常（如除零、溢出等），应捕获异常并使用默认参数或降级策略

> 说明（重要）：本 Feature 是 Platform-Capability Feature，提供可复用的算法引擎能力。
> - 算法引擎通过接口向业务 Feature 提供调度能力，业务 Feature 只调用接口，不关心算法实现细节。
> - 算法参数和调优策略由本 Feature 内部封装，业务 Feature 无需了解。

## 验收与场景 *（必填）*

> 说明：本节用于"可测试"的需求验收；**不等同于技术 Story**（技术 Story 在 Plan 阶段拆分）。

### 核心用户旅程（可选但强烈建议）

#### 旅程 1 - 首次学习单词

- **描述**：用户首次学习一个新单词，算法引擎记录学习状态并计算下次复习时间
- **成功信号**：单词被标记为"学习中"，系统计算出合理的首次复习间隔（如 1 天后）
- **验收场景**：
  1. **前提** 用户开始学习一个新单词，**当** 用户标记为"认识"或"不认识"，**则** 算法引擎记录学习状态（首次学习、学习结果）并计算下次复习时间
  2. **前提** 用户首次学习单词 A，**当** 用户标记为"认识"，**则** 算法引擎计算首次复习间隔为 1 天，单词 A 在 1 天后出现在复习列表中

#### 旅程 2 - 复习已学单词

- **描述**：用户在复习时间到达时复习单词，算法引擎根据复习结果更新记忆强度和下次复习时间
- **成功信号**：复习后，算法引擎根据正确/错误结果调整记忆强度，并计算新的复习间隔（正确则间隔延长，错误则缩短）
- **验收场景**：
  1. **前提** 单词 A 到达复习时间（如 3 天后），**当** 用户复习时标记为"认识"，**则** 算法引擎提高记忆强度，计算下次复习间隔延长（如 7 天后）
  2. **前提** 单词 B 到达复习时间，**当** 用户复习时标记为"不认识"，**则** 算法引擎降低记忆强度，重置复习间隔缩短（如 1 天后）

#### 旅程 3 - 学习进度管理

- **描述**：用户查看学习进度时，算法引擎提供学习统计数据和待复习单词列表
- **成功信号**：系统能够准确统计学习进度（已学习、待复习、已掌握），并根据算法计算提供准确的复习列表
- **验收场景**：
  1. **前提** 用户已完成 100 个单词的首次学习，**当** 用户查看学习进度，**则** 系统显示已学习 100 个单词，并显示根据算法计算的待复习单词数量
  2. **前提** 用户有 50 个单词到达复习时间，**当** 用户请求复习列表，**则** 算法引擎返回这 50 个单词的列表，按优先级排序

### 边界与异常场景（必填）

- **空词库** → 算法引擎返回空学习列表，不抛出异常
- **首次学习无历史数据** → 使用默认算法参数初始化学习状态
- **学习历史数据损坏** → 算法引擎能够容错处理，使用默认参数重新初始化，记录错误日志
- **算法计算异常（除零、溢出等）** → 捕获异常并使用默认参数或降级策略，记录错误日志
- **复习时间计算超范围** → 限制复习间隔在合理范围内（如最短 1 小时，最长 365 天），超出范围则截断
- **大量单词同时到达复习时间** → 支持批量计算，按优先级排序返回复习列表，避免性能问题
- **用户长时间未学习** → 算法引擎应考虑时间衰减因素，长时间未复习的单词应提高优先级
- **算法参数配置错误** → 参数校验失败时使用默认参数，记录警告日志

## FR / NFR *（必填）*

### FR（Functional Requirements）

> 规则：每条 FR 必须**可测试**，避免"提升体验/更快/更稳定"这类不可验证表述。

- **FR-001**：算法引擎必须能够根据单词的学习历史（学习次数、最后复习时间、回答正确率）计算下次复习时间
- **FR-002**：算法引擎必须支持基于遗忘曲线的间隔重复算法（如 SM-2 算法），能够根据复习结果动态调整复习间隔
- **FR-003**：算法引擎必须能够管理单词的学习状态（已学习、待复习、已掌握），并根据状态提供学习任务列表
- **FR-004**：算法引擎必须能够评估单词的记忆强度（基于学习次数、复习间隔、正确率），并用于优先级排序
- **FR-005**：算法引擎必须能够根据复习时间到达情况生成待复习单词列表，并按优先级排序
- **FR-006**：算法引擎必须能够在学习或复习操作后更新学习状态和计算下次复习时间

### NFR（Non-Functional Requirements）

> 规则：每条 NFR 必须**量化**并附带验收方式；细化评估在 Plan 阶段完成。

#### 性能（Performance）

- **NFR-PERF-001**：复习时机计算响应时间不超过 10ms（单个单词，p95）；批量计算（1000 个单词）不超过 500ms（p95）；学习任务列表生成不超过 200ms（p95）
- **NFR-PERF-002**：算法计算失败时，降级策略：使用默认参数或上次成功的计算结果，记录错误日志

#### 功耗（Power）

- **NFR-POWER-001**：假设 Top5% 用户每天学习 200 个单词，算法引擎每日电池消耗增量不超过 2mAh（主要来自算法计算和状态更新）

#### 内存（Memory）

- **NFR-MEM-001**：算法引擎内存占用峰值不超过 30MB（假设 10000 个单词的学习状态，每个状态约 3KB）；学习状态缓存生命周期：应用运行期间常驻，应用退出时持久化到存储
- **NFR-MEM-002**：学习状态数据应及时释放，已掌握单词（长时间未复习或达到掌握阈值）的状态数据可归档或清理

#### 安全与隐私（Security/Privacy）

- **NFR-SEC-001**：学习历史数据仅存储在本地设备，不上传云端；算法计算过程中的临时数据不记录到日志（符合 EPIC 隐私要求）

#### 可观测性（Observability）

- **NFR-OBS-001**：记录算法计算事件（单词 ID、计算类型、耗时、参数）；记录复习时机计算结果（单词 ID、下次复习时间、记忆强度）；记录算法异常事件（异常类型、异常详情）
- **NFR-OBS-002**：算法计算失败时记录错误日志（错误类型、输入参数、异常详情），便于问题排查和算法优化

#### 可靠性（Reliability）

- **NFR-REL-001**：复习时机计算成功率不低于 99.9%（排除输入数据错误的情况）；学习状态更新成功率 100%；学习任务列表生成成功率 100%
- **NFR-REL-002**：学习状态数据持久化：应用崩溃或退出时，学习状态必须保存，重启后恢复，算法计算应基于最新的学习状态

## 验收标准（Feature Level）*（必填）*

- **AC-001**：算法引擎能够根据学习历史计算下次复习时间，计算结果符合间隔重复算法规律（引用 FR-001）
- **AC-002**：算法引擎支持 SM-2 算法，能够根据复习结果动态调整复习间隔（引用 FR-002）
- **AC-003**：算法引擎能够管理单词学习状态，并提供准确的学习任务列表（引用 FR-003）
- **AC-004**：算法引擎能够评估单词记忆强度，并用于优先级排序（引用 FR-004）
- **AC-005**：算法引擎能够生成待复习单词列表，并按优先级排序（引用 FR-005）
- **AC-006**：算法引擎能够在学习或复习后更新状态和计算下次复习时间（引用 FR-006）
- **AC-007**：复习时机计算响应时间不超过 10ms（p95）（引用 NFR-PERF-001）
- **AC-008**：算法引擎内存占用峰值不超过 30MB（引用 NFR-MEM-001）
- **AC-009**：学习状态数据正确持久化，应用重启后恢复（引用 NFR-REL-002）

## 核心实体（如涉及数据则必填）

- **学习状态（LearningState）**：表示一个单词的学习状态，包含单词 ID、学习次数、最后复习时间、记忆强度、下次复习时间、掌握状态；一个单词对应一个学习状态记录
- **复习记录（ReviewRecord）**：表示一次复习操作，包含单词 ID、复习时间、复习结果（正确/错误）、复习间隔；用于学习历史跟踪和算法参数调优
- **算法参数（AlgorithmParameters）**：表示算法的配置参数，包含初始间隔、难度因子、间隔因子等；用于算法计算和参数调优

## 假设与约束 *（必填）*

- **假设**：
  - **假设1**：用户学习数据（学习历史、复习记录）能够可靠存储和查询，若数据不可用，算法引擎使用默认参数
  - **假设2**：词库数据包含单词 ID 和基础信息，算法引擎通过单词 ID 关联学习状态和词库数据
  - **假设3**：用户的学习行为符合间隔重复算法模型（定期复习、回答正确率反映记忆强度），若用户学习频率过低，算法效果会打折扣
  - **假设4**：算法参数在合理范围内（如初始间隔 1-7 天，难度因子 1.0-3.0），若参数超出范围，使用默认参数或边界值

- **约束**：
  - **平台约束**：Android 8.0+（API Level 26+），算法计算在本地设备执行，不依赖网络
  - **算法约束**：第一阶段使用经典算法（如 SM-2），不支持机器学习模型；算法参数使用通用配置，不支持个性化调优
  - **性能约束**：算法计算不能阻塞主线程，需在后台线程或协程中执行
  - **数据约束**：学习状态数据存储在本地，单用户学习单词数量不超过 10000 个

## 需求追溯（预留，Plan 后填写）

> 说明：此表在 Plan 的 Story Breakdown 完成后填写，用于确保 FR/NFR 被 Story 覆盖；Implement 不得擅自改写 FR/NFR。

| FR/NFR ID | 计划覆盖的 Story ID（Plan） | 任务覆盖（Tasks） | 备注 |
|---|---|---|---|
| FR-001 | ST-??? | T??? |  |
| FR-002 | ST-??? | T??? |  |
